<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghosts Gambling</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --bg-color: #121212; --primary-color: #1a1a1a; --secondary-color: #252525;
            --text-color: #e0e0e0; --accent-color: #ffffff; --border-radius: 8px;
            --shadow: 0 4px 15px rgba(0, 0, 0, 0.4); --safe-color: #2ecc71; --mine-color: #e74c3c;
            --roulette-red: #c0392b; --roulette-black: #2c3e50; --roulette-green: #27ae60;
        }
        * { box-sizing: border-box; }
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            margin: 0; height: 100vh; width: 100vw; overflow: hidden; font-size: 15px;
        }
        #app-container { display: none; flex-direction: row; width: 100%; height: 100%; }
        .sidebar { width: 240px; background-color: var(--primary-color); padding: 15px; display: flex; flex-direction: column; border-right: 1px solid var(--secondary-color); flex-shrink: 0; }
        .main-content { flex-grow: 1; padding: 25px; overflow-y: auto; height: 100%; }
        .chat-sidebar { width: 300px; background-color: var(--primary-color); padding: 15px; display: flex; flex-direction: column; border-left: 1px solid var(--secondary-color); flex-shrink: 0; height: 100%; }
        .logo { font-size: 22px; font-weight: bold; text-align: center; margin-bottom: 25px; color: var(--accent-color); }
        .nav-menu button { display: block; width: 100%; padding: 12px; margin-bottom: 8px; background-color: var(--secondary-color); color: var(--text-color); border: none; border-radius: var(--border-radius); text-align: left; font-size: 15px; cursor: pointer; transition: all 0.2s; }
        .nav-menu button:hover, .nav-menu button.active { background-color: var(--accent-color); color: var(--bg-color); transform: translateY(-2px); box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2); }
        .user-info { margin-top: auto; background-color: var(--secondary-color); padding: 12px; border-radius: var(--border-radius); position: relative; }
        .user-info-header { display: flex; align-items: center; justify-content: space-between; }
        .user-details { display: flex; align-items: center; min-width: 0; }
        .user-info img { width: 38px; height: 38px; border-radius: 50%; margin-right: 10px; object-fit: cover; flex-shrink: 0; }
        #username-display { font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } 
        #coins-display { font-size: 13px; color: #aaa; }
        #menu-button { background: none; border: none; color: var(--text-color); font-size: 22px; cursor: pointer; }
        .dropdown-menu { display: none; position: absolute; bottom: 60px; right: 12px; background-color: #333; border-radius: var(--border-radius); box-shadow: var(--shadow); overflow: hidden; z-index: 100; width: 140px; border: 1px solid #444; }
        .dropdown-menu a { display: block; padding: 10px 15px; color: var(--text-color); text-decoration: none; transition: background-color 0.2s; font-size: 14px; }
        .dropdown-menu a:hover { background-color: #454545; }
        .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h1 { margin-top: 0; padding-bottom: 15px; font-size: 24px; border-bottom: 1px solid var(--secondary-color); }
        h2 { border-bottom: 1px solid var(--secondary-color); padding-bottom: 10px; margin-top: 25px; margin-bottom: 20px; }
        h2:first-of-type { margin-top: 0; }
        .game-container { background-color: var(--primary-color); padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
        .game-controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: flex-end; margin-bottom: 20px; background-color: var(--secondary-color); padding: 15px; border-radius: var(--border-radius); }
        .game-controls .form-group { display: flex; flex-direction: column; }
        .game-controls label { font-size: 13px; color: #aaa; margin-bottom: 5px; }
        .game-controls input, .game-controls select { padding: 8px; background-color: var(--bg-color); border: 1px solid #444; border-radius: var(--border-radius); color: var(--text-color); max-width: 140px; font-size: 14px; }
        .custom-button { padding: 9px 18px; background-color: var(--accent-color); color: var(--bg-color); border: none; border-radius: var(--border-radius); cursor: pointer; font-size: 14px; font-weight: bold; transition: all 0.2s; }
        .custom-button:hover { background-color: #e0e0e0; transform: translateY(-1px); }
        .custom-button:disabled { background-color: #555; color: #888; cursor: not-allowed; transform: none; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.hidden { display: none; }
        .modal-content { background-color: var(--primary-color); padding: 25px; border-radius: var(--border-radius); box-shadow: var(--shadow); width: 90%; max-width: 400px; text-align: center; }
        .modal-content input { width: 100%; padding: 11px; margin-bottom: 12px; font-size: 15px; background-color: var(--secondary-color); border: 1px solid #444; border-radius: var(--border-radius); color: var(--text-color); }
        .modal-content .switch-link { color: var(--accent-color); cursor: pointer; text-decoration: underline; margin-top: 15px; display: inline-block; font-size: 14px; }
        .error-message { color: #ff5555; margin-bottom: 15px; min-height: 20px; text-align: left; font-size: 14px; }
        .auth-options { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 14px; color: #ccc; padding: 0 5px;}
        .auth-options label { display: flex; align-items: center; cursor: pointer; }
        .auth-options input[type="checkbox"] { margin-right: 8px; }

        /* ROULETTE STYLES - MODIFIED FOR NEW LAYOUT */
        #roulette-tab h1 { text-align: center; border-bottom: none; margin-bottom: 20px; }
        #roulette-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .roulette-top-section { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 40px; /* Increased gap */
            width: 100%; 
            flex-wrap: wrap; 
        }
        .roulette-wheel-container { position: relative; width: 320px; height: 320px; flex-shrink: 0; } /* Slightly larger wheel */
        .wheel-marker { position: absolute; top: -18px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 14px solid transparent; border-right: 14px solid transparent; border-top: 20px solid var(--accent-color); z-index: 5; }
        .roulette-wheel { width: 100%; height: 100%; border-radius: 50%; position: relative; transition: transform 6s cubic-bezier(0.1, 0.7, 0.3, 1); }
        #roulette-wheel-bg { width: 100%; height: 100%; border-radius: 50%; position: absolute; background-color: var(--roulette-black); box-shadow: inset 0 0 20px rgba(0,0,0,0.6), 0 0 15px rgba(0,0,0,0.3); border: 8px solid #855d3a; }
        .wheel-number-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .wheel-number { position: absolute; top: 50%; left: 50%; height: 50%; transform-origin: 0 0; font-weight: bold; font-size: 14px; color: white; text-shadow: 1px 1px 1px #000; text-align: center; }
        .wheel-number span { display: block; transform: rotate(-90deg) translateY(-150px); /* Adjusted for larger wheel */ }
        
        /* NEW: Class for the winning slot highlight */
        .wheel-number.winning-slot {
            background-color: var(--safe-color);
            transition: background-color 0.5s ease;
        }

        .roulette-controls { 
            display: flex; 
            flex-direction: column; 
            gap: 20px; /* Increased gap */
            background-color: var(--secondary-color); 
            padding: 25px; /* Increased padding */
            border-radius: var(--border-radius);
            width: 250px; /* Fixed width for control box */
            text-align: center;
        }
        .roulette-controls .form-group { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .roulette-controls label { margin-bottom: 0; font-size: 14px; }
        .roulette-controls input { max-width: 150px; text-align: center; font-size: 16px; }
        .roulette-controls .buttons { display: flex; gap: 10px; justify-content: center; }
        #roulette-status { font-size: 1.3em; font-weight: bold; min-height: 30px; text-align: center; }
        .roulette-table { background-color: var(--primary-color); padding: 10px; border-radius: var(--border-radius); width: 100%; max-width: 800px; margin-top: 20px; }
        .roulette-grid-container { display: grid; grid-template-columns: 50px 1fr 50px; gap: 5px; }
        .roulette-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 5px; }
        .roulette-cell { min-height: 45px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 13px; border-radius: 5px; cursor: pointer; transition: all 0.2s ease-out; position: relative; overflow: hidden; background-color: var(--secondary-color); }
        .roulette-cell:hover { transform: scale(1.1); z-index: 10; box-shadow: 0 0 10px rgba(255,255,255,0.2); }
        .roulette-cell.red { background-color: var(--roulette-red); color: white; }
        .roulette-cell.black { background-color: var(--roulette-black); color: white; }
        .zero-cell { grid-column: 1 / 2; grid-row: 1 / 4; display: flex; justify-content: center; align-items: center; }
        .column-bets { grid-column: 3 / 4; grid-row: 1 / 4; display: flex; flex-direction: column; gap: 5px; }
        .outside-bets-1 { display: grid; grid-column: 1 / 4; grid-template-columns: repeat(6, 1fr); gap: 5px; margin-top: 5px; }
        .outside-bets-2 { display: grid; grid-column: 1 / 4; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 5px; }
        .roulette-cell .bet-chip { position: absolute; bottom: 2px; right: 2px; width: 18px; height: 18px; background-color: #ffeb3b; color: black; font-size: 10px; line-height: 18px; border-radius: 50%; font-weight: bold; text-align: center; box-shadow: 0 0 5px rgba(0,0,0,0.5); display: none; }
        .roulette-cell.has-bet .bet-chip { display: block; }
        
        #bj-actions-container { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        #mines-info { display: flex; justify-content: space-between; align-items: center; background: var(--secondary-color); padding: 15px; border-radius: var(--border-radius); margin-top: 20px; }
        #mines-info-stats { display: flex; gap: 20px; }
        #mines-info-stats > div { text-align: center; }
        #mines-info-stats span { display: block; font-size: 14px; color: #aaa; }
        #mines-info-stats strong { font-size: 1.2em; }

        /* Admin Panel Styles */
        .admin-section { margin-bottom: 30px; background-color: var(--secondary-color); padding: 20px; border-radius: var(--border-radius); }
        .admin-section h3 { margin-top: 0; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .admin-form { display: flex; gap: 10px; flex-wrap: wrap; align-items: flex-end; }
        .admin-form input, .admin-form select { background-color: var(--bg-color); border-color: #444; }
        #not-admin-message h2 { font-size: 1.5em; color: var(--mine-color); text-align: center; }
        #not-admin-message p { text-align: center; color: #aaa; }
    </style>
</head>
<body>
    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content">
            <div id="login-form"><h2>Login</h2><div class="error-message" id="login-error"></div>
            <input type="text" id="login-username" placeholder="Username" required>
            <input type="password" id="login-password" placeholder="Password" required>
            <div class="auth-options"><label for="remember-me">
                <input type="checkbox" id="remember-me" checked> Remember Session</label></div>
                <button id="login-btn" class="custom-button">Login</button><p>Don't have an account? <span class="switch-link" onclick="toggleAuthForms()">Register here</span></p></div>
            <div id="register-form" style="display: none;"><h2>Register</h2><div class="error-message" id="register-error">
            </div><input type="text" id="register-username" placeholder="Username" required><input type="password" id="register-password" placeholder="Password (min 4 chars)" required>
            <button id="register-btn" class="custom-button">Register</button><p>Already have an account? <span class="switch-link" onclick="toggleAuthForms()">Login here</span></p></div>
        </div>
    </div>
    <div id="public-profile-modal" class="modal-overlay hidden"><div id="public-profile-content" class="modal-content"></div></div>
    
    <div id="app-container">
        <aside class="sidebar">
             <div class="logo">Ghosts Gambling</div>
            <nav class="nav-menu">
                <button class="nav-tab active" data-tab="home">Home</button>
                <button class="nav-tab" data-tab="blackjack">Blackjack</button>
                <button class="nav-tab" data-tab="mines">Mines</button>
                <button class="nav-tab" data-tab="roulette">Roulette</button>
            </nav>
            <div class="user-info">
                <div class="user-info-header"><div class="user-details"><img id="user-pfp-display" src="" alt="PFP"><div><div id="username-display"></div><div id="coins-display"></div></div></div><button id="menu-button">‚ò∞</button></div>
                <div class="dropdown-menu" id="dropdown-menu"><a href="#" id="profile-btn">Profile</a><a href="#" id="admin-btn">Admin</a><a href="#" id="logout-btn">Logout</a></div>
            </div>
        </aside>
        
        <main class="main-content">
            <div id="home-tab" class="tab-content active"><div class="home-container" style="display: flex; justify-content: center; align-items: center; text-align: center; height: 80%;"><div class="developer-block" style="background-color: var(--primary-color); padding: 40px; border-radius: var(--border-radius); box-shadow: var(--shadow); max-width: 400px;"><a href="https://fakecrime.bio/GhostUD" target="_blank" style="text-decoration:none;"><img src="https://i.imgur.com/8bzvETr.png" alt="Developer PFP" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--accent-color); margin-bottom: 20px; cursor: pointer; transition: transform 0.3s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"><h2>Developed by Ghost</h2><p style="color: #aaa; line-height: 1.6;">A full-stack gambling application using Node.js, Express, and WebSockets. All balances are virtual coins with no real-world value.</p></a></div></div></div>
            <div id="profile-page" class="tab-content"><h1>Edit Profile</h1><img id="profile-pfp-preview" src="" alt="Your PFP" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-color); margin-bottom: 20px;"><div class="form-group" style="text-align: left; margin-bottom: 20px;"><label for="profile-pfp-upload" style="display: block; margin-bottom: 8px; color: #aaa;">Upload New Profile Picture</label><input type="file" id="profile-pfp-upload" accept="image/jpeg, image/png, image/gif" style="width: 100%; padding: 8px; background-color: var(--secondary-color); border: 1px solid #444; border-radius: var(--border-radius); color: var(--text-color);"><small style="color:#aaa; margin-top:5px; display:block;">Max 25MB. Your old picture will be replaced.</small></div><div class="form-group" style="text-align: left; margin-bottom: 20px;"><label for="profile-bio" style="display: block; margin-bottom: 8px; color: #aaa;">Bio</label><textarea id="profile-bio" placeholder="Tell everyone a little about yourself..." style="width: 100%; padding: 12px; background-color: var(--secondary-color); border: 1px solid #444; border-radius: var(--border-radius); color: var(--text-color); min-height: 80px; resize: vertical;"></textarea></div><button id="save-profile-btn" class="custom-button">Save Changes</button></div>
            <div id="blackjack-tab" class="tab-content"><div class="game-container"><div class="game-controls"><div class="form-group"><label for="bj-bet-amount">Bet</label><input type="number" id="bj-bet-amount" value="100"></div><button id="bj-start-btn" class="custom-button">Start</button></div><div id="blackjack-game-area" class="game-area" style="display: none; text-align:center;"><div class="hand-container" style="margin: 20px 0; min-height: 150px;"><h3>Dealer (<span id="dealer-score">0</span>)</h3><div class="cards" id="dealer-cards" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; min-height: 125px;"></div></div><div class="game-status" id="bj-status" style="font-size: 1.2em; font-weight: bold; min-height: 30px; margin-top: 20px; color: var(--accent-color);"></div><div id="bj-actions" class="hand-container" style="margin: 20px 0; min-height: 150px;"><h3>You (<span id="player-score">0</span>)</h3><div class="cards" id="player-cards" style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; min-height: 125px;"></div><div id="bj-actions-container"><button id="bj-hit-btn" class="custom-button">Hit</button><button id="bj-stand-btn" class="custom-button">Stand</button></div></div></div></div></div>
            <div id="mines-tab" class="tab-content"><div class="game-container"><div class="game-controls"><div class="form-group"><label for="mines-bet-amount">Bet</label><input type="number" id="mines-bet-amount" value="100"></div><div class="form-group"><label for="mines-count">Mines</label><select id="mines-count"><option value="3">3</option><option value="5">5</option><option value="8">8</option><option value="10">10</option></select></div><button id="mines-start-btn" class="custom-button">Start</button></div><div id="mines-game-area" style="display: none;"><div class="mines-grid" id="mines-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; max-width: 350px; margin: 20px auto;"></div><div id="mines-info"><div id="mines-info-stats"><div><span>Profit</span><strong id="mines-profit">0</strong></div><div><span>Next Tile</span><strong id="mines-next-profit">0</strong></div></div><button id="mines-cashout-btn" class="custom-button" disabled>Cashout</button></div></div></div></div>
            <div id="roulette-tab" class="tab-content"><div id="roulette-container"><h1>Roulette</h1><div class="roulette-top-section"><div class="roulette-wheel-container"><div class="wheel-marker"></div><div class="roulette-wheel"><div id="roulette-wheel-bg"></div><div class="wheel-number-container" id="wheel-number-container"></div></div></div><div class="roulette-controls"><div class="form-group"><label for="roulette-bet-amount">Bet Amount:</label><input type="number" id="roulette-bet-amount" value="100"></div><div id="roulette-status">Place your bets!</div><div class="buttons"><button id="roulette-spin-btn" class="custom-button">Spin</button><button id="roulette-clear-btn" class="custom-button">Clear Bets</button></div></div></div><div class="roulette-table"><div class="roulette-grid-container" id="roulette-grid-container"></div></div></div></div>
            
            <div id="admin-page" class="tab-content">
                <h1>Admin Panel</h1>
                <div id="admin-actions-container" style="display: none;">
                    <h2>Admin Actions</h2>
                    <div class="admin-section">
                        <h3>Daily Reward</h3>
                        <p id="daily-claim-status">You can claim your daily 100,000 coins.</p>
                        <button id="claim-daily-btn" class="custom-button">Claim Now</button>
                    </div>
                    <div class="admin-section">
                        <h3>Chat Moderation</h3>
                        <button id="clear-chat-btn" class="custom-button">Clear Entire Chat</button>
                        <form id="timeout-user-form" class="admin-form" style="margin-top: 15px;">
                            <input type="text" id="timeout-username" placeholder="Username" required>
                            <input type="number" id="timeout-duration" placeholder="Duration (mins)" required>
                            <button type="submit" class="custom-button">Timeout User</button>
                        </form>
                    </div>
                </div>
                <div id="owner-actions-container" style="display: none;">
                    <h2>Owner Actions</h2>
                    <div class="admin-section">
                        <h3>Coin Management</h3>
                        <form id="give-coins-form" class="admin-form">
                             <input type="text" id="give-coins-username" placeholder="Username" required>
                             <input type="number" id="give-coins-amount" placeholder="Amount" required>
                             <button type="submit" class="custom-button">Give Coins</button>
                        </form>
                    </div>
                     <div class="admin-section">
                        <h3>Admin Status</h3>
                        <form id="set-admin-form" class="admin-form">
                             <input type="text" id="set-admin-username" placeholder="Username" required>
                             <select id="set-admin-status"><option value="true">Make Admin</option><option value="false">Remove Admin</option></select>
                             <button type="submit" class="custom-button">Update Status</button>
                        </form>
                    </div>
                </div>
                <div id="not-admin-message" style="display: none;">
                    <h2>No Access</h2>
                    <p>You are not an admin.</p>
                </div>
            </div>
        </main>
        
        <aside class="chat-sidebar"><div class="chat-container" style="display: flex; flex-direction: column; height: 50%;"><h3 style="margin: 0 0 10px 0; padding-bottom: 10px; border-bottom: 1px solid var(--secondary-color); font-size: 16px;">Online</h3><ul id="online-users-list" style="list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1;"></ul></div><div class="chat-container" style="display: flex; flex-direction: column; height: 50%;"><h3 style="margin: 0 0 10px 0; padding-bottom: 10px; border-bottom: 1px solid var(--secondary-color); font-size: 16px;">Chat</h3><ul id="chat-messages" style="list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; padding-right: 5px;"></ul><form id="chat-form" style="display: flex; margin-top: 10px;"><input id="chat-input" autocomplete="off" placeholder="Say something..." style="flex-grow: 1; padding: 10px; background-color: var(--secondary-color); border: 1px solid #444; border-radius: var(--border-radius); color: var(--text-color);" /></form></div></aside>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let token = null, socket = null, currentUser = null, newPfpBase64 = null;
        let isMinesGameOver = false;
        let wheelCurrentRotation = 0;
        const $ = s => document.querySelector(s), $$ = s => document.querySelectorAll(s);

        const apiCall = async (endpoint, options = {}) => { options.headers = { ...options.headers, 'Content-Type': 'application/json', 'Accept': 'application/json' }; if (token) options.headers['Authorization'] = `Bearer ${token}`; const response = await fetch(`/api${endpoint}`, options); if (!response.ok) { if (response.status === 401) logout(false); let err; try { const d = await response.json(); err = d.message; } catch (e) { err = await response.text(); } throw new Error(err || 'An unknown error occurred.'); } if (response.status === 204 || response.headers.get("content-length") === "0") return null; return response.json(); };
        window.toggleAuthForms = () => { $('#login-form').style.display = $('#login-form').style.display === 'none' ? 'block' : 'none'; $('#register-form').style.display = $('#register-form').style.display === 'none' ? 'block' : 'none'; $('#login-error').textContent = ''; $('#register-error').textContent = ''; };
        
        $('#register-btn').addEventListener('click', async () => { try { const data = await apiCall('/register', { method: 'POST', body: JSON.stringify({ username: $('#register-username').value, password: $('#register-password').value }) }); alert(data.message); toggleAuthForms(); } catch (err) { $('#register-error').textContent = err.message; } });
        $('#login-btn').addEventListener('click', async () => { const username = $('#login-username').value, password = $('#login-password').value; try { const data = await apiCall('/login', { method: 'POST', body: JSON.stringify({ username, password }) }); token = data.token; if ($('#remember-me').checked) localStorage.setItem('authToken', token); else sessionStorage.setItem('authToken', token); localStorage.setItem('lastUsername', username); initializeApp(); } catch (err) { $('#login-error').textContent = err.message; } });
        function logout(reload = true) { token = null; currentUser = null; localStorage.removeItem('authToken'); sessionStorage.removeItem('authToken'); if (socket) socket.disconnect(); if (reload) window.location.reload(); else { $('#auth-modal').style.display = 'flex'; $('#app-container').style.display = 'none'; } }
        $('#logout-btn').addEventListener('click', () => logout(true));

        async function initializeApp() { $('#auth-modal').style.display = 'none'; $('#app-container').style.display = 'flex'; try { await fetchProfile(); setupWebSocket(); setupUIEventListeners(); switchTab('home'); } catch (error) { console.error("Initialization failed:", error.message); logout(false); } }
        function checkForSavedSession() { token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken'); const lastUsername = localStorage.getItem('lastUsername'); if (lastUsername) $('#login-username').value = lastUsername; if (token) initializeApp(); else $('#auth-modal').style.display = 'flex'; }
        
        async function fetchProfile() { try { currentUser = await apiCall('/profile'); updateUserUI(); } catch (err) { console.error("Failed to fetch profile:", err); logout(false); } }
        function updateUserUI() { if (!currentUser) return; $('#username-display').textContent = currentUser.username; $('#coins-display').textContent = `${currentUser.coins.toLocaleString()} coins`; $('#user-pfp-display').src = currentUser.pfp; }
        
        function setupWebSocket() {
            if (socket) socket.disconnect();
            socket = io({ auth: { token } });
            socket.on('connect_error', (err) => { console.error("Socket connection error:", err.message); logout(false); });
            socket.on('online_users', users => { let l = ''; users.sort((a, b) => b.coins - a.coins).forEach(u => { l += `<li data-username="${u.username}" style="display: flex; align-items: center; padding: 6px; border-radius: 8px; transition: background-color 0.2s; cursor: pointer;" onmouseover="this.style.backgroundColor='var(--secondary-color)'" onmouseout="this.style.backgroundColor='transparent'"><img src="${u.pfp}" alt="${u.username}" style="width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; object-fit: cover; flex-shrink: 0;"><div class="user-details-list" style="flex-grow: 1;"><div class="username" style="font-weight: bold; font-size: 14px;">${u.username}</div><div class="coins" style="font-size: 12px; color: #aaa;">${u.coins.toLocaleString()} coins</div></div></li>`; }); $('#online-users-list').innerHTML = l; });
            socket.on('chat_history', msgs => { $('#chat-messages').innerHTML = ''; msgs.forEach(addChatMessage); });
            socket.on('chat_message', addChatMessage);
            socket.on('message_deleted', messageId => { const msgEl = $(`[data-message-id="${messageId}"]`); if (msgEl) msgEl.remove(); });
            socket.on('chat_cleared', () => { $('#chat-messages').innerHTML = ''; });
            socket.on('chat_error', (msg) => alert(msg));
            
            $('#chat-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const input = $('#chat-input');
                const message = input.value.trim();
                if (message) {
                    socket.emit('chat_message', message);
                    input.value = '';
                }
            });
        }
        function addChatMessage(msg) {
            const cb = $('#chat-messages');
            const isOwnMessage = msg.username === currentUser.username;
            const fiveMinutes = 5 * 60 * 1000;
            const isDeletable = (currentUser.isAdmin || currentUser.isOwner) || (isOwnMessage && (Date.now() - new Date(msg.timestamp).getTime() < fiveMinutes));
            const deleteButton = isDeletable ? `<span class="delete-msg-btn" data-message-id="${msg._id}" title="Delete message" style="margin-left: auto; font-size: 14px; cursor: pointer; opacity: 0.5; transition: opacity 0.2s;">üóëÔ∏è</span>` : '';
            const escapedMsg = msg.message.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            const li = document.createElement('li');
            li.className = 'message-item';
            li.dataset.messageId = msg._id;
            li.style.cssText = 'display: flex; align-items: flex-start; padding: 6px 5px; margin-bottom: 6px; word-wrap: break-word; font-size: 14px;';
            li.innerHTML = `<img src="${msg.pfp || 'https://i.imgur.com/8bzvETr.png'}" alt="${msg.username}" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 10px; object-fit: cover; flex-shrink: 0;"><div class="message-content" style="display: flex; flex-direction: column; flex-grow: 1;"><div class="message-header" style="display: flex; align-items: center;"><span class="message-user" data-username="${msg.username}" style="font-weight: bold; cursor: pointer; color: var(--accent-color);">${msg.username}</span><span class="message-timestamp" style="font-size: 10px; color: #888; margin-left: 8px;">${new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>${deleteButton}</div><div>${escapedMsg}</div></div>`;
            cb.appendChild(li);
            cb.scrollTop = cb.scrollHeight;
        }
        function setupUIEventListeners() { $$('.nav-tab').forEach(b => b.addEventListener('click', () => switchTab(b.dataset.tab))); $('#menu-button').addEventListener('click', (e) => { e.stopPropagation(); $('#dropdown-menu').style.display = $('#dropdown-menu').style.display === 'block' ? 'none' : 'block'; }); document.addEventListener('click', () => { $('#dropdown-menu').style.display = 'none'; }); $('#profile-btn').addEventListener('click', e => { e.preventDefault(); switchTab('profile-page'); loadProfileForEditing(); }); $('#admin-btn').addEventListener('click', e => { e.preventDefault(); switchTab('admin-page'); loadAdminPanel(); }); $('#save-profile-btn').addEventListener('click', saveProfile); const eventDelegate = (container, event, selector, handler) => { container.addEventListener(event, e => { if (e.target.closest(selector)) handler(e, e.target.closest(selector)); }); }; eventDelegate($('#chat-messages'), 'click', '.message-user', (e, el) => showPublicProfile(el.dataset.username)); eventDelegate($('#chat-messages'), 'click', '.delete-msg-btn', (e, el) => socket.emit('delete_message', el.dataset.messageId)); eventDelegate($('#online-users-list'), 'click', 'li', (e, el) => showPublicProfile(el.dataset.username)); $('#public-profile-modal').addEventListener('click', e => { if (e.target.id === 'public-profile-modal') e.target.classList.add('hidden'); }); $('#profile-pfp-upload').addEventListener('change', handlePfpUpload); setupBlackjackListeners(); setupMinesListeners(); setupRouletteListeners(); setupAdminListeners(); }
        function switchTab(id) { $$('.tab-content').forEach(t => t.classList.remove('active')); $$('.nav-tab').forEach(b => b.classList.remove('active')); const el = $(`#${id}-tab`) || $(`#${id}`); if (el) el.classList.add('active'); const nb = $(`.nav-tab[data-tab="${id}"]`); if (nb) nb.classList.add('active'); }
        function loadProfileForEditing() { $('#profile-pfp-preview').src = currentUser.pfp; $('#profile-bio').value = currentUser.bio; newPfpBase64 = null; $('#profile-pfp-upload').value = ''; }
        function handlePfpUpload(event) { const file = event.target.files[0]; if (!file) return; if (file.size > 25 * 1024 * 1024) { alert("File is too large! Max 25MB."); return; } const reader = new FileReader(); reader.onload = (e) => { newPfpBase64 = e.target.result; $('#profile-pfp-preview').src = newPfpBase64; }; reader.readAsDataURL(file); }
        async function saveProfile() { try { const payload = { bio: $('#profile-bio').value }; if (newPfpBase64) payload.pfp = newPfpBase64; await apiCall('/profile/update', { method: 'POST', body: JSON.stringify(payload) }); await fetchProfile(); alert('Profile updated!'); switchTab('home'); } catch (err) { alert(err.message); } }
        async function showPublicProfile(u) { try { const d = await apiCall(`/user/${u}`); $('#public-profile-content').innerHTML = `<img src="${d.pfp}" alt="PFP" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-color); margin-bottom: 20px;"><h2>${d.username}</h2><div class="profile-info" style="text-align: left; margin-bottom: 20px;"><span style="font-weight: bold; color: #aaa; font-size: 1.1em;">Bio:</span><p style="margin-top: 5px; background-color: var(--secondary-color); padding: 12px; border-radius: var(--border-radius); white-space: pre-wrap; word-wrap: break-word;">${d.bio || 'No bio set.'}</p></div><button class="custom-button" onclick="document.getElementById('public-profile-modal').classList.add('hidden')">Close</button>`; $('#public-profile-modal').classList.remove('hidden'); } catch (err) { alert(err.message); } }
        const createCardHTML = c => { if (c.value === '?') return `<div class="card hidden" style="width: 75px; height: 110px; font-size: 22px; background: repeating-linear-gradient(45deg, #4a4a4a, #4a4a4a 10px, #555 10px, #555 20px); border-radius: 8px;"></div>`; const s = { H: '‚ô•', D: '‚ô¶', C: '‚ô£', S: '‚ô†' }; const r = ['H', 'D'].includes(c.suit); return `<div class="card" style="width: 75px; height: 110px; font-size: 22px; background-color: var(--accent-color); color: ${r ? 'red' : 'black'}; border-radius: 8px; display: flex; justify-content: center; align-items: center; font-weight: bold; position: relative;"><span class="top" style="position: absolute; font-size: 16px; top: 5px; left: 8px;">${c.value}${s[c.suit]}</span>${c.value}<span class="bottom" style="position: absolute; font-size: 16px; bottom: 5px; right: 8px; transform: rotate(180deg);">${c.value}${s[c.suit]}</span></div>`; };
        function updateBlackjackUI(g) { $('#player-cards').innerHTML = g.playerHand.map(createCardHTML).join(''); $('#dealer-cards').innerHTML = g.dealerHand.map(createCardHTML).join(''); $('#player-score').textContent = g.playerValue; $('#dealer-score').textContent = g.dealerValue || '?'; $('#bj-status').textContent = g.status; if (typeof g.newBalance !== 'undefined') { currentUser.coins = g.newBalance; updateUserUI(); } const p = g.status === 'playing'; $('#bj-hit-btn').style.display = p ? 'inline-block' : 'none'; $('#bj-stand-btn').style.display = p ? 'inline-block' : 'none'; $('#bj-start-btn').disabled = p; }
        function setupBlackjackListeners() { $('#bj-start-btn').addEventListener('click', async () => { try { $('#blackjack-game-area').style.display = 'block'; const g = await apiCall('/blackjack/start', { method: 'POST', body: JSON.stringify({ bet: parseInt($('#bj-bet-amount').value) }) }); updateBlackjackUI(g); } catch (err) { alert(err.message); } }); const doAction = async (a) => { try { $('#bj-hit-btn').disabled = true; $('#bj-stand-btn').disabled = true; const g = await apiCall('/blackjack/action', { method: 'POST', body: JSON.stringify({ action: a }) }); updateBlackjackUI(g); $('#bj-hit-btn').disabled = false; $('#bj-stand-btn').disabled = false; } catch (err) { alert(err.message); } }; $('#bj-hit-btn').addEventListener('click', () => doAction('hit')); $('#bj-stand-btn').addEventListener('click', () => doAction('stand')); }
        function setupMinesListeners() { $('#mines-start-btn').addEventListener('click', startMines); $('#mines-cashout-btn').addEventListener('click', cashoutMines); }
        async function startMines() { try { isMinesGameOver = false; const bet = parseInt($('#mines-bet-amount').value), minesCount = parseInt($('#mines-count').value); const data = await apiCall('/mines/start', { method: 'POST', body: JSON.stringify({ bet, minesCount }) }); currentUser.coins = data.newBalance; updateUserUI(); renderMinesGrid(); $('#mines-game-area').style.display = 'block'; $('#mines-start-btn').disabled = true; $('#mines-cashout-btn').disabled = true; $('#mines-profit').textContent = '0'; const mult = { 3: 1.15, 5: 1.3, 8: 1.5, 10: 1.8 }[minesCount]; $('#mines-next-profit').textContent = `${Math.floor(bet * mult - bet)}`; } catch (err) { alert(err.message); } }
        function renderMinesGrid() { let g = $('#mines-grid'); g.innerHTML = ''; for (let i = 0; i < 25; i++) { const c = document.createElement('div'); c.className = 'mine-cell'; c.style.cssText = 'width: 100%; padding-bottom: 100%; background-color: var(--secondary-color); border-radius: var(--border-radius); cursor: pointer; transition: background-color 0.2s; position: relative;'; c.addEventListener('mouseover', (e) => { if (!isMinesGameOver && !e.target.classList.contains('safe')) e.target.style.backgroundColor = '#444'; }); c.addEventListener('mouseout', (e) => { if (!e.target.classList.contains('safe')) e.target.style.backgroundColor = 'var(--secondary-color)'; }); c.dataset.index = i; c.addEventListener('click', handleMineClick); g.appendChild(c); } }
        async function handleMineClick(e) { const cell = e.target; if (isMinesGameOver || cell.classList.contains('safe')) return; try { const data = await apiCall('/mines/click', { method: 'POST', body: JSON.stringify({ index: parseInt(cell.dataset.index) }) }); if (data.gameOver) { isMinesGameOver = true; alert(data.message); data.minePositions.forEach(p => $(`.mine-cell[data-index='${p}']`).style.backgroundColor = 'var(--mine-color)'); resetMinesGame(false); } else { cell.style.backgroundColor = 'var(--safe-color)'; cell.classList.add('safe'); $('#mines-cashout-btn').disabled = false; $('#mines-profit').textContent = data.profit; const bet = parseInt($('#mines-bet-amount').value); $('#mines-next-profit').textContent = `${Math.floor(bet * data.nextMultiplier - bet)}`; } } catch (err) { alert(err.message); resetMinesGame(true); } }
        async function cashoutMines() { try { isMinesGameOver = true; const data = await apiCall('/mines/cashout', { method: 'POST' }); alert(data.message); currentUser.coins = data.newBalance; updateUserUI(); resetMinesGame(true); } catch (err) { alert(err.message); } }
        function resetMinesGame(hide) { $('#mines-start-btn').disabled = false; $('#mines-cashout-btn').disabled = true; if (hide) $('#mines-game-area').style.display = 'none'; }
        
        // ROULETTE LOGIC --- MODIFIED FOR HIGHLIGHTING
        const ROULETTE_NUMBERS_ORDER = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26]; const ROULETTE_COLORS = { 0: 'green', 1: 'red', 2: 'black', 3: 'red', 4: 'black', 5: 'red', 6: 'black', 7: 'red', 8: 'black', 9: 'red', 10: 'black', 11: 'black', 12: 'red', 13: 'black', 14: 'red', 15: 'black', 16: 'red', 17: 'black', 18: 'red', 19: 'red', 20: 'black', 21: 'red', 22: 'black', 23: 'red', 24: 'black', 25: 'red', 26: 'black', 27: 'red', 28: 'black', 29: 'black', 30: 'red', 31: 'black', 32: 'red', 33: 'black', 34: 'red', 35: 'black', 36: 'red' }; let rouletteBets = {}; let isSpinning = false;
        function createRouletteTable() { const container = $('#roulette-grid-container'); container.innerHTML = ''; const zeroContainer = document.createElement('div'); zeroContainer.className = 'zero-cell'; const grid = document.createElement('div'); grid.className = 'roulette-grid'; const colsContainer = document.createElement('div'); colsContainer.className = 'column-bets'; const outside1 = document.createElement('div'); outside1.className = 'outside-bets-1'; const outside2 = document.createElement('div'); outside2.className = 'outside-bets-2'; const zeroCell = document.createElement('div'); zeroCell.className = 'roulette-cell green'; zeroCell.textContent = '0'; zeroCell.dataset.betType = 'number'; zeroCell.dataset.betValue = '0'; zeroContainer.appendChild(zeroCell); for (let i = 1; i <= 36; i++) { const cell = document.createElement('div'); cell.className = `roulette-cell number ${ROULETTE_COLORS[i]}`; cell.style.gridRow = (i-1) % 3 + 1; cell.style.gridColumn = Math.ceil(i/3); cell.textContent = i; cell.dataset.betType = 'number'; cell.dataset.betValue = i; grid.appendChild(cell); } [{l:'2:1',v:'1st'},{l:'2:1',v:'2nd'},{l:'2:1',v:'3rd'}].forEach(b => { const cell = document.createElement('div'); cell.className = 'roulette-cell outside'; cell.textContent = b.l; cell.dataset.betType = 'column'; cell.dataset.betValue = b.v; colsContainer.appendChild(cell); }); [{l:'1-18',t:'range',v:'1-18'},{l:'Even',t:'parity',v:'even'},{l:'Red',t:'color',v:'red',c:'red'},{l:'Black',t:'color',v:'black',c:'black'},{l:'Odd',t:'parity',v:'odd'},{l:'19-36',t:'range',v:'19-36'}].forEach(b=>{ const cell = document.createElement('div'); cell.className = `roulette-cell outside ${b.c||''}`; cell.textContent = b.l; cell.dataset.betType = b.t; cell.dataset.betValue = b.v; outside1.appendChild(cell); }); [{l:'1st 12',t:'dozen',v:'1st'},{l:'2nd 12',t:'dozen',v:'2nd'},{l:'3rd 12',t:'dozen',v:'3rd'}].forEach(b=>{ const cell = document.createElement('div'); cell.className = 'roulette-cell outside'; cell.textContent = b.l; cell.dataset.betType = b.t; cell.dataset.betValue = b.v; outside2.appendChild(cell); }); container.append(zeroContainer, grid, colsContainer, outside1, outside2); $$('.roulette-cell').forEach(cell => cell.innerHTML += '<span class="bet-chip"></span>'); }
        function createRouletteWheel() { const bg = $('#roulette-wheel-bg'); const numbersContainer = $('#wheel-number-container'); bg.innerHTML = ''; numbersContainer.innerHTML = ''; const sliceAngle = 360 / ROULETTE_NUMBERS_ORDER.length; const gradientParts = ROULETTE_NUMBERS_ORDER.map((num, i) => { const color = ROULETTE_COLORS[num]; return `var(--roulette-${color}) ${i * sliceAngle}deg ${(i + 1) * sliceAngle}deg`; }); bg.style.background = `conic-gradient(${gradientParts.join(', ')})`; ROULETTE_NUMBERS_ORDER.forEach((num, index) => { const rotation = (index * sliceAngle) + (sliceAngle / 2); const numberDiv = document.createElement('div'); numberDiv.className = 'wheel-number'; numberDiv.style.transform = `rotate(${rotation}deg)`; numberDiv.dataset.number = num; /* Added for easy selection */ const numberSpan = document.createElement('span'); numberSpan.textContent = num; numberDiv.appendChild(numberSpan); numbersContainer.appendChild(numberDiv); }); }
        function handleRouletteBet(e) { if (isSpinning) return; const cell = e.target.closest('.roulette-cell'); if (!cell || !cell.dataset.betType) return; const betAmount = parseInt($('#roulette-bet-amount').value, 10); if (isNaN(betAmount) || betAmount <= 0) { alert("Please enter a valid bet amount."); return; } const { betType, betValue } = cell.dataset; rouletteBets[betType] = rouletteBets[betType] || {}; rouletteBets[betType][betValue] = (rouletteBets[betType][betValue] || 0) + betAmount; updateRouletteUI(); }
        function updateRouletteUI() { let totalBet = 0; $$('.roulette-cell').forEach(cell => { cell.classList.remove('has-bet'); const chip = cell.querySelector('.bet-chip'); if (chip) { chip.style.display = 'none'; } }); for (const type in rouletteBets) { for (const value in rouletteBets[type]) { const amount = rouletteBets[type][value]; totalBet += amount; const cell = $(`.roulette-cell[data-bet-type="${type}"][data-bet-value="${value}"]`); if (cell) { cell.classList.add('has-bet'); const chip = cell.querySelector('.bet-chip'); if (chip) { chip.textContent = amount > 999 ? `${Math.floor(amount/1000)}k` : amount; chip.style.display = 'block'; } } } } $('#roulette-spin-btn').disabled = totalBet === 0 || isSpinning; }
        function clearRouletteBets() { if(isSpinning) return; rouletteBets = {}; $('#roulette-status').textContent = 'Place your bets!'; $('#roulette-status').style.color = 'var(--accent-color)'; const winningSlot = $('.winning-slot'); if (winningSlot) { winningSlot.classList.remove('winning-slot'); } updateRouletteUI(); }
        async function spinRouletteWheel() { if (isSpinning || Object.keys(rouletteBets).length === 0) return; isSpinning = true; updateRouletteUI(); clearRouletteBets(); /* Clear previous win highlight */ $('#roulette-status').textContent = 'Spinning...'; $('#roulette-status').style.color = 'var(--accent-color)'; try { const result = await apiCall('/roulette/spin', { method: 'POST', body: JSON.stringify({ bets: rouletteBets }) }); const { winningNumber, winnings, newBalance, message } = result; const wheel = $('.roulette-wheel'); const numberIndex = ROULETTE_NUMBERS_ORDER.indexOf(winningNumber); const sliceAngle = 360 / ROULETTE_NUMBERS_ORDER.length; const targetAngle = -(numberIndex * sliceAngle); wheelCurrentRotation = wheelCurrentRotation - (wheelCurrentRotation % 360) + (360 * 10) + targetAngle + (Math.random() * sliceAngle/2 - sliceAngle/4); wheel.style.transform = `rotate(${wheelCurrentRotation}deg)`; setTimeout(() => { isSpinning = false; currentUser.coins = newBalance; updateUserUI(); $('#roulette-status').textContent = message; $('#roulette-status').style.color = winnings > 0 ? 'var(--safe-color)' : 'var(--mine-color)'; const winningSlotBG = $(`#roulette-wheel-bg .wheel-number[data-number="${winningNumber}"]`); if (winningSlotBG) { const sliceElements = $$('#roulette-wheel-bg .wheel-number'); sliceElements.forEach(el => el.classList.remove('winning-slot')); winningSlotBG.parentElement.classList.add('winning-slot'); } const winningSlot = $(`.wheel-number[data-number="${winningNumber}"]`); if (winningSlot) { winningSlot.classList.add('winning-slot'); } clearRouletteBets(); }, 6100); } catch (err) { alert(err.message); isSpinning = false; clearRouletteBets(); updateRouletteUI(); } }
        function setupRouletteListeners() { createRouletteTable(); createRouletteWheel(); $('#roulette-grid-container').addEventListener('click', handleRouletteBet); $('#roulette-clear-btn').addEventListener('click', clearRouletteBets); $('#roulette-spin-btn').addEventListener('click', spinRouletteWheel); }
        
        function loadAdminPanel() { if (!currentUser) return; const isAdmin = currentUser.isAdmin, isOwner = currentUser.isOwner; if (!isAdmin && !isOwner) { $('#admin-actions-container').style.display = 'none'; $('#owner-actions-container').style.display = 'none'; $('#not-admin-message').style.display = 'block'; return; } $('#not-admin-message').style.display = 'none'; $('#admin-actions-container').style.display = 'block'; if (isOwner) $('#owner-actions-container').style.display = 'block'; else $('#owner-actions-container').style.display = 'none'; const twentyFourHours = 24 * 60 * 60 * 1000, lastClaim = new Date(currentUser.lastDailyClaim); if (currentUser.lastDailyClaim && (new Date() - lastClaim < twentyFourHours)) { $('#daily-claim-status').textContent = `Next claim in ${Math.ceil((twentyFourHours - (new Date() - lastClaim)) / (1000 * 60 * 60))} hours.`; $('#claim-daily-btn').disabled = true; } else { $('#daily-claim-status').textContent = 'You can claim your daily 100,000 coins.'; $('#claim-daily-btn').disabled = false; } }
        function setupAdminListeners() {
            $('#claim-daily-btn').addEventListener('click', async () => { try { const data = await apiCall('/admin/claim-daily', { method: 'POST' }); alert(data.message); currentUser.coins = data.newBalance; currentUser.lastDailyClaim = data.lastDailyClaim; updateUserUI(); loadAdminPanel(); } catch (error) { alert(error.message); } });
            $('#clear-chat-btn').addEventListener('click', async () => { if (confirm('Are you sure you want to delete ALL chat messages permanently?')) { try { const data = await apiCall('/admin/clear-chat', { method: 'POST' }); alert(data.message); } catch (error) { alert(error.message); } } });
            $('#timeout-user-form').addEventListener('submit', async (e) => { e.preventDefault(); const username = $('#timeout-username').value, duration = $('#timeout-duration').value; try { const data = await apiCall('/admin/timeout-user', { method: 'POST', body: JSON.stringify({ username, duration }) }); alert(data.message); $('#timeout-username').value = ''; $('#timeout-duration').value = ''; } catch (error) { alert(error.message); } });
            $('#give-coins-form').addEventListener('submit', async (e) => { e.preventDefault(); const username = $('#give-coins-username').value, amount = $('#give-coins-amount').value; try { const data = await apiCall('/owner/give-coins', { method: 'POST', body: JSON.stringify({ username, amount }) }); alert(data.message); $('#give-coins-username').value = ''; $('#give-coins-amount').value = ''; } catch (error) { alert(error.message); } });
            $('#set-admin-form').addEventListener('submit', async (e) => { e.preventDefault(); const username = $('#set-admin-username').value, isAdmin = $('#set-admin-status').value === 'true'; try { const data = await apiCall('/owner/set-admin', { method: 'POST', body: JSON.stringify({ username, isAdmin }) }); alert(data.message); $('#set-admin-username').value = ''; } catch (error) { alert(error.message); } });
        }
        
        checkForSavedSession();
    });
    </script>
</body>
</html>